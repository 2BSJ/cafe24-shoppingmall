<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="user">

	<select id="countById" resultType="int" parameterType='string'>
		<![CDATA[	 
		select count(*)
		  from user 
		 where id = #{id}
		]]>
	</select>

	<insert id="insertVo" parameterType="uservo">
		<![CDATA[
			INSERT 
		   	INTO user 
		   	VALUES(null, 
		   		#{name},
		   		#{id}, 
		   		SHA2(#{password},512), 
		   		now(), 
		  		#{phoneNumber}, 
		   		#{age}, 
		   		AES_ENCRYPT(#{address},SHA2(#{key},512)), 
		   		AES_ENCRYPT(#{email},SHA2(#{key},512)), 
		   		#{gender},
		   		0,
		   		0,
		   		#{role})	
		]]>
	</insert>

	<select id="getByIdAndPassword" resultType="uservo"
		parameterType='uservo'>
		<![CDATA[	 		
		SELECT no,name,id,reg_date as regDate,phone_number as phoneNumber,age,
		convert(AES_DECRYPT(address, SHA2('${key}', 512)) using utf8) as address,
		convert(AES_DECRYPT(email, SHA2('${key}',512)) using utf8) as email,
		gender,point,ordercount,role
		from user
		where id = #{id}
		and password=SHA2(#{password}, 512);
		]]>
	</select>
	
	<update id="updateVo" parameterType="uservo">
		<![CDATA[
		update user
		]]>
		<trim prefix="SET" suffixOverrides=",">
		<if test="password != null">
			<![CDATA[
			password=SHA2(#{password}, 512),
			]]>
		</if>
		<if test="email != null">
			<![CDATA[
			email=AES_ENCRYPT(#{email},SHA2(#{key},512)),
			]]>
		</if>
		<if test="address != null">
			<![CDATA[
			address=AES_ENCRYPT(#{address},SHA2(#{key},512)),
			]]>
		</if>
		<if test="phoneNumber != null">
			<![CDATA[
			phone_number=#{phoneNumber},
			]]>
		</if>		   
		<![CDATA[
		 where no = #{no}      	 
		]]>
		</trim>
	</update>
	
	
	<select id="getByNo" resultType="uservo" parameterType='long'>
		<![CDATA[	 
		select no, name
		  from user 
		 where no = #{value }
		]]>
	</select>

	<select id="getByEmail" resultType="uservo" parameterType='string'>
		<![CDATA[	 
		select no, name, email, gender
		  from user 
		 where email = #{value }
		]]>
	</select>



	
</mapper>